{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://domstol.no/da/varetekt/1.0/KjennelseVaretekt.schema.json",
  "description": "Schema definisjon av en Kjennelse-varetekt",

  "properties": {
    "melding": {
      "type": "string",
      "enum": ["VARETEKT_KJENNELSE"],
      "description": "Type melding"
    },
    "forsendelse": {
      "$ref": "#/definitions/forsendelse"
    },
    "aktoerer": {
      "$comment": "Skal vi kalle dette domstol-aktører. Evt. ta med 'siktede' inn under aktører",
      "description": "Aktører fra domstolen",
      "properties": {
        "dommer": {
          "$ref": "#/definitions/ansattPerson",
          "description": "Dommer på saken"
        },
        "saksbehandler": {
          "$ref": "#/definitions/ansattPerson",
          "description": "Saksbehandler på saken"
        }
      },
      "type": "object",
      "additionalProperties": false
    },
    "siktede": {
      "$ref": "#/definitions/privatPerson"
    },
    "dokumenter": {
      "type": "array",
      "items": { "$ref": "#/definitions/dokument" }
    },
    "saksInformasjon": {
      "$ref": "#/definitions/saksInformasjon"
    }
  },
  "required": [
    "melding",
    "forsendelse",
    "aktoerer",
    "siktede",
    "saksInformasjon",
    "dokumenter"
  ],
  "type": "object",
  "additionalProperties": false,
  "definitions": {
    "saksInformasjon": {
      "properties": {
        "saksnummer": {
          "type": "string",
          "description": "Domstolen sitt interne saksnummer"
        },
        "straffesaksnummer": {
          "type": "string",
          "description": "Politiet sitt interne saksnummer"
        },
        "rettsmoeteTidFra": {
          "$ref": "#/definitions/datoTid"
        },
        "rettsmoeteTidTil": {
          "$ref": "#/definitions/datoTid"
        },
        "avgjoerelse": {
          "$ref": "#/definitions/avgjoerelse"
        }
      },
      "required": [
        "saksnummer",
        "straffesaksnummer",
        "rettsmoeteTidFra",
        "rettsmoeteTidTil",
        "avgjoerelse"
      ],
      "type": "object",
      "additionalProperties": false
    },
    "avgjoerelse": {
      "properties": {
        "avgjoerelseId": {
          "type": "string",
          "description": "Domstolen sin nøkkel til avgjørelsen. Kan bli brukt i forbindelse med anke/forlengelse"
        },
        "avsagtDato": {
          "$ref": "#/definitions/dato"
        },
        "kravid": {
          "type": "string",
          "description": "Kravid som opprettes i politiet"
        },
        "kravType": {
          "type": "string",
          "$comment": "Burde dette vært en enum i stedet? Eks: FHVaretekt"
        },
        "restriksjoner": {
          "type": "array",
          "items": { "$ref": "#/definitions/restriksjon" }
        },
        "isolasjonsKrav": {
          "type": "array",
          "items": { "$ref": "#/definitions/isolasjon" }
        },
        "fengsling": {
          "$ref": "#/definitions/fengsling"
        }
      },
      "required": [
        "avgjoerelseId",
        "avsagtDato",
        "kravid",
        "kravType",
        "fengsling",
        "restriksjoner",
        "isolasjonsKrav"
      ],
      "type": "object",
      "additionalProperties": false
    },
    "fengsling": {
      "properties": {
        "fengslingsId": {
          "type": "string",
          "description": "fengslingsid som opprettes i DA (GUID)"
        },
        "fraDato": {
          "$ref": "#/definitions/dato"
        },
        "tilDato": {
          "$ref": "#/definitions/dato"
        },
        "fengslingsFristDato": {
          "$ref": "#/definitions/dato"
        },
        "lovbud": {
          "$ref": "#/definitions/lovbud"
        },
        "merknad": {
          "type": "string",
          "description": "Merknad til fengslingen"
        },
        "anke": {
          "$ref": "#/definitions/anke",
          "description": "Settes kun dersom fengslingen ankes før kjennelsen sendes til påtale"
        },
        "tattTilFoelge": {
          "type": "boolean",
          "description": "Settes til true dersom det blir fengsling"
        }
      },
      "required": ["fengslingsId", "tattTilFoelge"],
      "type": "object",
      "additionalProperties": false
    },
    "restriksjon": {
      "properties": {
        "restriksjonsId": {
          "type": "string",
          "description": "restriksjonsId som opprettes i DA (GUID)"
        },
        "restriksjonsType": {
          "$ref": "#/definitions/restriksjonsType"
        },
        "fraDato": {
          "description": "Om begjæringen ikke tas til følge skal dette feltet settes til null",
          "$ref": "#/definitions/dato"
        },
        "tilDato": {
          "description": "Om begjæringen ikke tas til følge skal dette feltet settes til null",
          "$ref": "#/definitions/dato"
        },
        "lovbud": {
          "$ref": "#/definitions/lovbud"
        },
        "anke": {
          "$ref": "#/definitions/anke",
          "description": "Settes kun dersom restrikjsonen ankes før kjennelsen sendes til påtale"
        },
        "tattTilFoelge": {
          "type": "boolean",
          "description": "Settes til true dersom denne restriksjonstypen er begjært og det blir en kjennelse på den"
        }
      },
      "required": ["restriksjonsId", "tattTilFoelge"],
      "type": "object",
      "additionalProperties": false
    },
    "isolasjon": {
      "properties": {
        "isolasjonsId": {
          "type": "string",
          "description": "isolasjonsId som opprettes i DA (GUID)"
        },
        "isolasjonsType": {
          "$ref": "#/definitions/isolasjonsType"
        },
        "fraDato": {
          "$ref": "#/definitions/dato",
          "description": "Om begjæringen ikke tas til følge skal dette feltet settes til null"
        },
        "tilDato": {
          "$ref": "#/definitions/dato",
          "description": "Om begjæringen ikke tas til følge skal dette feltet settes til null"
        },
        "lovbud": {
          "$ref": "#/definitions/lovbud",
          "$comment": "Trenger vi dette for isolasjon??"
        },
        "anke": {
          "$ref": "#/definitions/anke",
          "description": "Settes kun dersom isolasjonen ankes før kjennelsen sendes til påtale"
        },
        "tattTilFoelge": {
          "type": "boolean",
          "description": "Settes til true dersom denne isolasjonstypen er begjært og det blir kjennelse på den"
        }
      },
      "required": ["isolasjonsId", "tattTilFoelge"],
      "type": "object",
      "additionalProperties": false
    },

    "lovbud": {
      "properties": {
        "lovbudsId": {
          "type": "string",
          "description": "Politiets interne lovbudsnummer. Blank om det er endret i domstolen eller ikke fått fra politi"
        },
        "lovbudStreng": {
          "type": "string"
        }
      },
      "required": ["lovbudStreng"],
      "type": "object",
      "additionalProperties": false
    },
    "anke": {
      "properties": {
        "anketDato": {
          "$ref": "#/definitions/dato"
        },
        "anketAv": {
          "$ref": "#/definitions/anketAvType"
        },
        "oppsettendeVirkning": {
          "type": "boolean"
        }
      },
      "required": ["anketDato", "anketAv"],
      "type": "object",
      "additionalProperties": false
    },
    "restriksjonsType": {
      "description": "Liste over de ulike restriksjonene",
      "enum": [
        "BREV_OG_BESOEKSFORBUD",
        "BREV_OG_BESOEKSKONTROLL",
        "MEDIEFORBUD"
      ],
      "type": "string"
    },
    "isolasjonsType": {
      "description": "Liste over de ulike isolasjonstyper",
      "enum": ["FULL", "DELVIS"],
      "type": "string"
    },
    "anketAvType": {
      "description": "Liste over alle som kan anke",
      "enum": ["SIKTET", "AKTOR"],
      "type": "string"
    },
    "forsendelse": {
      "properties": {
        "meldingsId": { "type": "string" },
        "sendtTid": { "type": "string", "format": "date-time" },
        "avsender": { "$ref": "#/definitions/avsender" },
        "mottaker": { "$ref": "#/definitions/mottaker" },
        "rettelse": {
          "type": "boolean",
          "description": "Settes til true dersom det er en menneskelig endring av en tidligere kjennelse. (Dersom meldingen er resendt av tekniske årsaker vil denne stå som false)",
          "default": false
        }
      },
      "required": [
        "meldingsId",
        "avsender",
        "mottaker",
        "sendtTid",
        "rettelse"
      ],
      "type": "object",
      "additionalProperties": false
    },
    "avsender": {
      "properties": {
        "organisasjon": { "$ref": "#/definitions/organisasjon" },
        "person": {
          "description": "Person som sender meldingen. Vanligvis dommeren eller saksbehandleren",
          "$ref": "#/definitions/ansattPerson"
        }
      },
      "required": ["organisasjon"],
      "type": "object",
      "additionalProperties": false
    },
    "mottaker": {
      "properties": {
        "organisasjon": { "$ref": "#/definitions/organisasjon" }
      },
      "required": ["organisasjon"],
      "type": "object",
      "additionalProperties": false
    },
    "organisasjon": {
      "description": "Entydig identifikator av juridisk enhet. F.eks et spesifikt domstol embete eller politidistrikt",
      "properties": {
        "navn": {
          "type": "string",
          "description": "F.eks. Nordland politidistrikt eller Oslo tingrett."
        },
        "organisasjonsnummer": {
          "type": "string",
          "description": "Norsk organisasjonsnummer fra BRREG. Referanse til politidistrikt, embete osv.",
          "maxLength": 20,
          "minLength": 2
        }
      },
      "required": ["organisasjonsnummer"],
      "type": "object",
      "additionalProperties": false
    },
    "dokument": {
      "description": "Et dokument har en ID for at det skal kunne refereres til fra andre steder.",
      "properties": {
        "internId": {
          "description": "Referanse/journal nummer fra BL, Lovisa eller KODA/Kompis",
          "type": "string",
          "minLength": 2,
          "maxLength": 50
        },
        "forsendelse": {
          "$ref": "#/definitions/dokumentforsendelse"
        },
        "overskrift": {
          "description": "Klippe på slutten hvis det er for langt",
          "type": "string",
          "minLength": 2,
          "maxLength": 260
        },
        "skrevetDato": {
          "$ref": "#/definitions/dato"
        },
        "kategori": {
          "$ref": "#/definitions/kodeverk"
        }
      },
      "required": ["forsendelse", "overskrift", "kategori"],
      "type": "object",
      "additionalProperties": false
    },

    "dokumentforsendelse": {
      "description": "Detaljer om lokasjon og type",
      "properties": {
        "mimeType": { "type": "string" },
        "sjekksum": { "type": "string" },
        "uri": { "type": "string" }
      },
      "required": ["mimeType", "sjekksum", "uri"],
      "type": "object",
      "additionalProperties": false
    },

    "ansattPerson": {
      "description": "Type for personer som er ansatt hos påtale eller domstolen(saksbehandlere, påtaleadvokater, statsadvokater,...)",
      "properties": {
        "brukeridentifikasjon": {
          "type": "string",
          "description": "Brukernavn til de ansatte"
        },
        "etternavn": { "type": "string" },
        "fornavn": { "type": "string" },
        "tittel": { "type": "string" }
      },
      "required": ["etternavn", "brukeridentifikasjon"],
      "type": "object",
      "additionalProperties": false
    },

    "privatPerson": {
      "description": "Person som har en rolle i en straffesak (siktet, mistenkt, osv) der det er krav om fødselsnummer for nordmenn. Andre identifikatorer kan være interne, DUF nummer, pass nummer ...",
      "properties": {
        "etternavn": { "type": "string" },
        "fornavn": { "type": "string" },
        "identitetsnummer": {
          "$ref": "#/definitions/personIdentifikator",
          "description": "Fødselsnummer, D-nummer eller SSP nummer. Alle personer som det er foretatt tvangsmidler mot skal ha et D-nummer eller fødselsnummer. Dersom politiet ikke har et slikt nummer vil de generere ett 'SSP nummer'"
        },
        "tilleggsId": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/personIdentifikator"
          },
          "description": "Kan f.eks. være historiske SSP nummer. "
        },
        "foedselsdato": {
          "$ref": "#/definitions/dato",
          "description": "Påbudt i BL i dag, men er ikke sikkert politiet vet."
        },
        "kjoenn": {
          "$ref": "#/definitions/kjoenn"
        },
        "nasjonalitet": {
          "$ref": "#/definitions/landType",
          "description": "Nasjonalitet ikke med hvis det er ukjent."
        }
      },
      "required": ["etternavn", "identitetsnummer", "tilleggsId"],
      "type": "object",
      "additionalProperties": false
    },
    "landType": {
      "description": "En landkode bestaar av tre store bokstaver fra kodelisten ISO 3166-1-alpha-3. Hentes fra kodeverk nationality.xml",
      "type": "object",
      "properties": {
        "kode": {
          "type": "string",
          "pattern": "[A-Z]+",
          "minLength": 3,
          "maxLength": 3
        },
        "navn": { "type": "string" }
      },
      "required": ["kode"]
    },
    "personIdentifikator": {
      "description": "Fødselsnummer, D-nummer eller SSP nummer.",
      "type": "object",
      "properties": {
        "foedselsnummer": { "$ref": "#/definitions/foedselsnummer" },
        "sspNummer": { "$ref": "#/definitions/sspNummer" },
        "dNummer": { "$ref": "#/definitions/dNummer" }
      },
      "oneOf": [
        {
          "properties": {
            "foedselsnummer": {
              "$ref": "#/definitions/foedselsnummer",
              "description": "Kun norsk fødselsnummer. Hvis det er et D-nummer så kommer det i eget felt."
            }
          },
          "required": ["foedselsnummer"],
          "additionalProperties": false
        },
        {
          "properties": {
            "sspNummer": { "$ref": "#/definitions/sspNummer" }
          },
          "required": ["sspNummer"],
          "additionalProperties": false
        },
        {
          "properties": {
            "dNummer": { "$ref": "#/definitions/dNummer" }
          },
          "required": ["dNummer"],
          "additionalProperties": false
        }
      ]
    },
    "foedselsnummer": {
      "type": "string",
      "pattern": "[0-9]+",
      "minLength": 11,
      "maxLength": 11
    },
    "sspNummer": {
      "type": "string",
      "pattern": "[0-9]+",
      "minLength": 11,
      "maxLength": 11
    },
    "dNummer": {
      "type": "string",
      "pattern": "[0-9]+",
      "minLength": 11,
      "maxLength": 11
    },

    "kodeverk": {
      "properties": {
        "kode": { "type": "string" },
        "navn": { "type": "string" }
      },
      "type": "object",
      "required": ["kode"],
      "additionalProperties": false
    },
    "epost": {
      "description": "Lange epostadresser.",
      "maxLength": 150,
      "minLength": 5,
      "type": "string"
    },
    "kjoenn": {
      "description": "Samme enum som folkeregisteret",
      "enum": ["KVINNE", "MANN"],
      "type": "string"
    },
    "datoTid": {
      "type": "string",
      "format": "date-time"
    },
    "dato": {
      "type": "string",
      "format": "date"
    }
  }
}
