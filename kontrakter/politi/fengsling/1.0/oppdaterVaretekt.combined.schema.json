{
  "$schema": "http://json-schema.org/schema#",

  "type": "object",
  "properties": {
	  "oppdaterVaretekt": {"$ref": "#/$defs/oppdaterVaretekt"}
  },
  "additionalProperties": false,

  "$defs": {
    "oppdaterVaretekt": {
      "description": "Kjennelse fra domstolen eller oppdatering av restriksjoner/isolasjon fra påtale",
      "type": "object",
      "required": [
        "forsendelse",
        "hovedStraffesaksnummer",
        "varetektSyklusId",
        "ordreId",
        "ordreKjennelse"
      ],
      "additionalProperties": false,
      "properties": {
        "forsendelse": {"$ref": "#/defsForsendelse/forsendelse"},
        "hovedStraffesaksnummer": {"type": "string"},
        "varetektSyklusId": {"type": "string"},
        "personVaretekt": {"$ref": "#/defsPerson/personFull"},
        "ordreId": {"type": "string"},
        "ordreKjennelse": {"oneOf": [{"$ref": "#/defsVaretekt/ordrePaataleOneOf"},{"$ref": "#/defsVaretekt/kjennelseVaretektOneOf"}]},
        "paagrepetTidspunkt": {"type": "string","format": "date-time"},
        "dokumenter": {"type": "array", "items": {"$ref" : "#/defsDokument/dokument"}}
      }
    }
  },
  "defsBasistyper": {
    "adresse": {
      "type" : "object",
      "properties": {
        "adresselinjer" : {
          "type": "array",
          "items": {"type": "string","minLength": 1, "maxLength": 500},
          "minContains": 1,
          "maxContains": 4
        },
        "postnummer" : {"type": "string"},
        "poststed" : {"type": "string"},
        "land": {"$ref": "#/defsBasistyper/land"}
        },
      "required" : ["adresselinjer"],
      "additionalProperties": false
    },
	  "kodeverk" : {
		  "properties": {
			"kode" : {"type" : "string"},
			"navn" : {"type" : "string"}
		  },
		  "required" : ["kode"],
		  "additionalProperties": false
	  },
	  "kontaktInfo" : {
		  "properties": {
			"epost" : {"type" : "string"},
 			"telefon" : {"type" : "string"}
		  },
		  "additionalProperties": false
	  },
    "land": {
      "description": "ISO-3166, Kosovo kommer",
      "type": "object",
      "properties": {
        "kode" : {"type": "string", "pattern": "[A-Z]+", "minLength": 3, "maxLength": 3},
        "navn" : {"type": "string"}
        },
      "required" : ["kode"]
    },
    "organisasjon": {
      "description": "Organisasjon som kan sende eller motta JustisHub meldinger",
      "type": "object",
      "properties": {
        "organisasjonsnummer": {"type": "string"},
        "navn": {"type": "string"},
        "kontakt" : {"$ref" : "#/defsBasistyper/kontaktInfo"}
        },
      "required": ["organisasjonsnummer","navn"],
      "additionalProperties": false
    },
	  "ansatt": {
      "description": "Saksbehandler, jurist etterforsker hos politiet, ansatte hos domstolene eller kriminalomsorgen",
      "type": "object",
      "properties": {
        "brukeridentifikasjon": {"type": "string"},
        "tittel" :  {"type": "string"},
        "navn": {
          "type" : "object",
          "properties": {
            "fornavn" : {"type": "string"},
            "mellomnavn" : {"type": "string"},
            "etternavn" : {"type": "string"}
            },
          "required" : ["etternavn"],
          "additionalProperties": false
        },
        "kontakt" : {"$ref" : "#/defsBasistyper/kontaktInfo"}
      },
      "required" : ["navn"],
      "additionalProperties": false
    }
  },
  "defsDokument": {
    "dokument" : {
      "description": "Dokument som oversendes på justishub",
      "properties": {
        "internId" : {"type" : "string"},
        "kategori" : {"$ref" : "#/defsBasistyper/kodeverk"},
        "overskrift" : {"type" : "string"},
        "skrevetDato": {"type": "string", "format": "date"},
        "forsendelse" : {"$ref" : "#/defsDokument/dokumentForsendelse"}
      },
      "required" : ["overskrift", "forsendelse"],
      "additionalProperties": false
    },

    "dokumentForsendelse" : {
      "description": "Detaljer om lokasjon og ty9pe",
      "properties": {
        "mimeType" : {"type" : "string"},
        "uri" : {"type" : "string"},
        "sjekksum" : {"type" : "string"}
      },
      "required" : ["mimeType", "uri", "sjekksum"],
      "additionalProperties": false
    },
    "dokumentRef" : {
      "description": "Referanse internt i melding til dokumenter i dokumentlisten",
      "properties": {
        "internId" : {"type" : "string"}
      },
      "required" : ["internId"],
      "additionalProperties": false
    }
  },
   "defsForsendelse" :{
	  "forsendelse" : {
		  "properties": {
			"meldingsId" : {"type": "string"},
			"sendtTid" : {"type": "string", "format" : "date-time"},
			"avsender" : {"$ref": "#/defsForsendelse/avsender"},
			"mottaker" : {"$ref": "#/defsForsendelse/mottaker"}
		  },
		  "required" : ["meldingsId", "avsender", "mottaker", "sendtTid"],
		  "additionalProperties": false
	  },
	  "avsender" : {
		  "properties": {
			  "organisasjon" : {"$ref": "#/defsBasistyper/organisasjon"},
			  "saksbehandler" : {"$ref": "#/defsBasistyper/ansatt"}
		  },
		  "required" : ["organisasjon"],
		  "additionalProperties": false
	},
	  "mottaker" : {
		  "properties": {
			  "organisasjon" : {"$ref": "#/defsBasistyper/organisasjon"}
		  },
		  "required" : ["organisasjon"],
		  "additionalProperties": false
    }
  },
  "defsLovbud" :{

    "lovbudFull" : {
      "description": "Lovvbudreferanse med gjengivelse og strafferamme",
      "properties": {
        "lovbudId" : {"type" : "string"},
        "lovbudStreng" : {"type" : "string"},
        "gjengivelse" : {"type" : "string"},
        "hjemmel" : {"type" : "array", "items": {"$ref": "#/defsLovbud/lovreferanse"},"minItems": 1},
        "strafferamme": {"type": "integer", "description": "Antall måneder"}
      },
      "required" : ["lovbudStreng", "gjengivelse"],
      "additionalProperties": false
    },

    "lovbudGjengivelse" : {
      "description": "Lovvbudreferanse med gjengivelse",
      "properties": {
        "lovbudId" : {"type" : "string"},
        "lovbudStreng" : {"type" : "string"},
        "gjengivelse" : {"type" : "string"}
      },
      "required" : ["lovbudStreng", "gjengivelse"],
      "additionalProperties": false
    },

    "lovbudEnkel" : {
      "description": "Enkel lovbudreferanse kun lovbudstreng",
      "properties": {
        "lovbudId" : {"type" : "string"},
        "lovbudStreng" : {"type" : "string"}
      },
      "required" : ["lovbudStreng"],
      "additionalProperties": false
    },
    "lovreferanse" : {
      "description": "Eksakt referanse inn i spesifikk lov, paragraf, ledd osv.",
      "properties": {
        "rettskilde" : {"$ref": "#/defsBasistyper/kodeverk"},
        "lovreferanse" : {"type" : "array", "items": {"$ref": "#/defsLovbud/lovreferanseElement"},"minItems": 1}
      },
      "required" : ["rettskilde", "lovreferanse"],
      "additionalProperties": false
    },

    "lovreferanseElement" : {
      "description": "Referanse til paragraf, ledd osv, type kan bli enum som er utvidbar .. PARAGRAG, LEDD, STRAFFALTERNATIV",
      "properties": {
        "type" : {"type" : "string"},
        "verdi" : {"type" : "string"}
      },
      "required" : ["type", "verdi"],
      "additionalProperties": false
    }
	},
  "defsVaretekt" :{

		"anke": {
      "description": "Anke av fengsling/restriksjon/kjennelse",
      "type": "object",
      "required": ["anketAv", "oppsettendeVirkning"],
      "additionalProperties": false,
			"properties": {				
				
				"anketDato": {"type": "string", "format": "date"},
				"anketAv": {"$ref": "#/defsVaretekt/anketAvType"},
				"oppsettendeVirkning": {"type": "boolean"					
				}
			}
		},		
		"anketAvType": {
			"description": "Hvem av partene har anket",
			"enum": ["SIKTET","FORSVARER", "AKTOR"],
			"type": "string"
		},

    "avgjoerelseDomstol": {
      "description": "Kjennelse(r) fra retten, etter anke kan antagelig flere retter være involvert og da må vi endre denne",
      "type": "object",
      "required": ["kjennelse"],
      "additionalProperties": false,
      "properties": {
        "merknad": {"type": "string"},
        "kjennelse": {"type": "string"}
      }
    },
    "fengsling": {
      "description": "Basis fengsling med til og fra dato",
      "type": "object",
      "required": ["lovbud"],
      "additionalProperties": false,
      "properties": {
        "lovbud": {"$ref": "#/defsLovbud/lovbudEnkel"},
        "fraDato": {"type": "string", "format": "date"},
        "tilDato": {"type": "string", "format": "date"}
      }
    },
    "fengslingKjennelse": {
      "description": "Fengsling som en del av kjennelsen, uten datoer så er det ikke noe fengsel",
      "type": "object",
      "required": ["fengsling", "domstol"],
      "additionalProperties": false,
      "properties": {
        "domstol": {"$ref": "#/defsBasistyper/organisasjon"},
        "avsagtDato": {"type": "string", "format": "date"},
        "fengsling": {"$ref": "#/defsVaretekt/fengsling"},
        "anke": {"$ref": "#/defsVaretekt/anke"}
      }
    },

    "isolasjon": {
      "description": "Basis isolasjon med til og fra dato, brukes uten datoer på innsettelsesordre",
      "type": "object",
      "required": ["isolasjonsType"],
      "additionalProperties": false,
      "properties": {
        "id": {"type": "string"},
        "isolasjonsType": {"$ref": "#/defsVaretekt/isolasjonsType"},
        "lovbud": {"$ref": "#/defsLovbud/lovbudEnkel"},
        "fraDato": {"type": "string", "format": "date"},
        "tilDato": {"type": "string", "format": "date"}
      }
    },
    "isolasjonBegjaering": {
      "type": "object",
      "required": ["id","isolasjonsType","lovbud","periode"],
      "additionalProperties": false,
      "properties": {
        "id": {"type": "string"},
        "isolasjonsType": {"$ref": "#/defsVaretekt/isolasjonsType"},
        "lovbud": {"$ref": "#/defsLovbud/lovbudEnkel"},
        "periode": {"$ref": "#/defsVaretekt/periodeStartAntall"}
      }
    },
    "isolasjonOrdre": {
      "description": "Isolasjon fra påtale, dvs. fraDato eller tilDato vil ikke være utfylt før første kjennelse",
      "type": "object",
      "required": ["merknad","isolasjon"],
      "additionalProperties": false,
      "properties": {
        "merknad": {"type": "string"},
        "isolasjon": {"type": "array", "items": {"$ref": "#/defsVaretekt/isolasjon"}}
      }
    },
    "isolasjonKjennelse": {
      "description": "Isolasjon fra domstolen, når vi har mottatt den, uten til fra dato kun når det er anke",
      "type": "object",
      "required": ["isolasjon", "domstol"],
      "additionalProperties": false,
      "properties": {
        "domstol": {"$ref": "#/defsBasistyper/organisasjon"},
        "avsagtDato": {"type": "string", "format": "date"},
        "isolasjon": {"$ref": "#/defsVaretekt/isolasjon"},
        "anke": {"$ref": "#/defsVaretekt/anke"}
      }
    },
    "isolasjonsType": {
      "description": "Liste over de ulike isolasjonstyper",
      "enum": [
        "FULL_ISOLASJON",
        "DELVIS_ISOLASJON"
      ],
      "type": "string"
    },
    "kjennelseVaretekt": {
      "description": "Kjennelse på varetektsfengsling fra domstolen som sendes til Kriminalomsorgen",
      "type": "object",
      "required": ["fengsling"],
      "additionalProperties": false,
      "properties": {
        "merknad": {"type": "string"},
        "fengsling": {"$ref": "#/defsVaretekt/fengslingKjennelse"},
        "restriksjoner": {"type" : "array", "items": {"$ref": "#/defsVaretekt/restriksjonKjennelse"}},
        "isolasjon": {"type" : "array", "items": {"$ref": "#/defsVaretekt/restriksjonKjennelse"}}
      }
    },
    "kjennelseVaretektOneOf": {
      "description": "Enkelt øvereste nivå på OneOf i hovedskjema",
      "type": "object",
      "required": ["kjennelse"],
      "additionalProperties": true,
      "properties": {
        "merknad": {"type": "string"},
        "kjennelse": {"$ref": "#/defsVaretekt/kjennelseVaretekt"}
      }
    }, 
    "ordreVaretektPaatale": {
      "description": "Påtale sin ordre/beslutning om fengsling i fengsel, før vi har en kjennelse fra retten og for å lette på restriksjoner, det er implisit at det er fengsling",
      "type": "object",
      "required": [
        "besluttetAv",
        "tidspunkt"
      ],
      "additionalProperties": false,
      "properties": {
        "merknad": {"type": "string"},
        "besluttetAv": {"$ref" : "#/defsBasistyper/ansatt"},
        "tidspunkt": {"type": "string", "format": "date-time"},
        "restriksjoner": {"$ref": "#/defsVaretekt/restriksjonerOrdre"},
        "isolasjon": {"$ref": "#/defsVaretekt/isolasjonOrdre"}
      }
    },
    "ordrePaataleOneOf": {
      "description": "Enkelt øvereste nivå på OneOf i hovedskjema",
      "type": "object",
      "required": ["ordre"],
      "additionalProperties": false,
      "properties": {
        "merknad": {"type": "string"},
        "ordre": {"$ref": "#/defsVaretekt/ordreVaretektPaatale"}
      }
    },    
    "periodeStartAntall": {
      "description": "Periode for fensling eller restriksjon, bruker ikke å spesifisere startdato, derfor lengde og antall dager inn i fengslingen for restriksjoner",
      "type": "object",
      "required": ["startDag","antallDager"],
      "additionalProperties": false,
      "properties": {
        "startDag": {"type": "integer"},
        "antallDager": {"type": "integer"}
      }
    },
    "restriksjon": {
      "description": "Basis restriksjon med til og fra dato,  brukes uten datoer på innsettelsesordre",
      "type": "object",
      "required": ["restriksjonsType"],
      "additionalProperties": false,
      "properties": {
        "id": {"type": "string"},
        "restriksjonsType": {"$ref": "#/defsVaretekt/restriksjonsType"},
        "lovbud": {"$ref": "#/defsLovbud/lovbudEnkel"},
        "fraDato": {"type": "string", "format": "date"},
        "tilDato": {"type": "string", "format": "date"}
      }
    },

    "restriksjonBegjaering": {
      "type": "object",
      "required": [
        "id",
        "restriksjonsType",
        "lovbud",
        "periode"
      ],
      "additionalProperties": false,
      "properties": {
        "id": {"type": "string"},
        "restriksjonsType": {"$ref": "#/defsVaretekt/restriksjonsType"},
        "lovbud": {"$ref": "#/defsLovbud/lovbudEnkel"},
        "periode": {"$ref": "#/defsVaretekt/periodeStartAntall"}
      }
    },
    "restriksjonKjennelse": {
      "description": "Restriksjon fra domstolen, når vi har mottatt den, uten til fra dato kun når det er anke",
      "type": "object",
      "required": ["restriksjon", "domstol"],
      "additionalProperties": false,
      "properties": {
        "domstol": {"$ref": "#/defsBasistyper/organisasjon"},
        "avsagtDato": {"type": "string", "format": "date"},
        "restriksjon": {"$ref": "#/defsVaretekt/restriksjon"},
        "anke": {"$ref": "#/defsVaretekt/anke"}
      }
    },
    "restriksjonerOrdre": {
      "description": "Restriksjon fra påtale, dvs. fraDato eller tilDato vil ikke være utfylt før første kjennelse",
      "type": "object",
      "required": ["merknad","restriksjoner"],
      "additionalProperties": false,
      "properties": {
        "merknad": {"type": "string"},
        "restriksjoner": {"type": "array", "items": {"$ref": "#/defsVaretekt/restriksjon"}}
      }
    },
    "restriksjonsType": {
      "description": "Liste over de ulike restriksjonene",
      "enum": [
        "BREV_OG_BESOEKSFORBUD",
        "BREV_OG_BESOEKSKONTROLL",
        "MEDIEFORBUD",
        "ANNET"
      ],
      "type": "string"
    }
 	},
  "defsPerson" :{
    "foedselsnummer": {"type" : "string", "pattern": "[0-9]+", "minLength": 11, "maxLength": 11},
    "sspNummer": {"type" : "string", "pattern": "[0-9]+", "minLength": 11, "maxLength": 11},
    "dNummer": {"type" : "string", "pattern": "[0-9]+", "minLength": 11, "maxLength": 11},
    "foretak": {
      "description": "Foretak/ organisasjon som er med i en straffesak som f.eks. fornærmet",
      "type": "object",
      "properties": {
        "internId": {"type": "string"},
        "organisasjonsnummer": {"type": "string"},
        "navn": {"type": "string"},
        "adresse": {"$ref": "#/defsBasistyper/adresse"}
        },
      "required": ["internId","navn"],
      "additionalProperties": false
    },
    "foretakMini": {
      "description": "Foretak/ organisasjon som er med i en straffesak som f.eks. fornærmet",
      "type": "object",
      "properties": {
        "internId": {"type": "string"},
        "organisasjonsnummer": {"type": "string"},
        "navn": {"type": "string"}
        },
      "required": ["internId","navn"],
      "additionalProperties": false
    },
    "foretakNivaa": {
      "description": "Ekstra nivå for å få med foretak navn på item i miks liste",
      "type": "object",
      "required": ["foretak"],
      "properties": {
        "foretak" : {"$ref": "#/defsPerson/foretak"}
      }
    },

    "kjoenn" : {
      "description" : "Samme enum som folkeregisteret",
      "type" : "string", "enum" : ["KVINNE","MANN"]},
    "personnavn": {
      "type" : "object",
      "properties": {
        "fornavn" : {"type": "string"},
        "mellomnavn" : {"type": "string"},
        "etternavn" : {"type": "string"}
        },
      "required" : ["etternavn"],
      "additionalProperties": false
    },

    "personForetakArray": {
      "type": "array",
      "title": "Array med person og/eller foretak",
      "items": {
        "anyOf": [
          {
            "$ref": "#/defsPerson/personFullNivaa"
          },
          {
            "$ref": "#/defsPerson/foretakNivaa"
          }
        ]
      }
    },
    "personFullNivaa": {
      "description": "Ekstra nivå for å få med person navn på item",
      "type": "object",
      "required": ["person"],
      "properties": {
        "person" : {"$ref": "#/defsPerson/personFull"}
      }
    },
   
    "personFull": {
      "description": "Person med alle nyttige data som fødselsnummer adresse osv., SSP nummer kun på siktede, tiltalte.",
      "type": "object",
      "properties": {
        "internId": {"type": "string"},
        "navn": {"$ref" : "#/defsPerson/personnavn"},
        "foedselsdato": {"type" : "string", "format" : "date"},
        "kjoenn": {"$ref" : "#/defsPerson/kjoenn"},
        "statsborgerskap": {"type": "array", "items": {"$ref": "#/defsBasistyper/land"}},
        "foedselsnummer": {"type": "array", "items": {"$ref": "#/defsPerson/foedselsnummer"}},
        "sspNummer": {"type": "array", "items": {"$ref": "#/defsPerson/sspNummer"}},
        "dNummer": {"type": "array", "items": {"$ref": "#/defsPerson/dNummer"}},
        "adresse": {"$ref": "#/defsBasistyper/adresse"}
      },
      "required" : ["internId","navn","foedselsdato"],
      "additionalProperties": false
    },

    "personMini": {
      "description": "Kun navn og fødselsdato (hvis den finnes)",
      "type": "object",
      "properties": {
        "internId": {"type": "string"},
        "navn": {"$ref" : "#/defsPerson/personnavn"},
        "foedselsdato": {"type" : "string", "format" : "date"}
      },
      "required" : ["internId","navn"],
      "additionalProperties": false
    },
	  "profesjonellPerson": {
      "description": "Advokater, tolker, sakkyndige vitner",
      "type": "object",
      "properties": {
        "tittel" :  {"type": "string"},
        "navn": {
          "type" : "object",
          "properties": {
            "fornavn" : {"type": "string"},
            "mellomnavn" : {"type": "string"},
            "etternavn" : {"type": "string"}
            },
          "required" : ["etternavn"],
          "additionalProperties": false
        },
        "kontakt" : {"$ref" : "#/defsBasistyper/kontaktInfo"}
      },
      "required" : ["navn"],
      "additionalProperties": false
    }
  }

}